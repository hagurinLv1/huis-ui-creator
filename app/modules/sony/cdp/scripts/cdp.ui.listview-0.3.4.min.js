/*!
 * cdp.ui.listview.js 0.3.4
 *
 * Date: 2015-08-26T14:28:55
 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],function(c,d,e){return b(a.CDP||(a.CDP={}),c,d,e)}):"object"==typeof exports?module.exports=b(a.CDP||(a.CDP={}),require("jquery"),require("underscore"),require("backbone")):b(a.CDP||(a.CDP={}),a.$,a._,a.Backbone)}((this||0).self||global,function(a,b,c,d){a.UI=a.UI||{};var a;!function(a){var b;!function(a){var b;!function(a){a.WRAPPER_CLASS="listview-wrapper",a.WRAPPER_SELECTOR="."+a.WRAPPER_CLASS,a.SCROLL_MAP_CLASS="listview-scroll-map",a.SCROLL_MAP_SELECTOR="."+a.SCROLL_MAP_CLASS,a.INACTIVE_CLASS="inactive",a.INACTIVE_CLASS_SELECTOR="."+a.INACTIVE_CLASS,a.RECYCLE_CLASS="listview-recycle",a.RECYCLE_CLASS_SELECTOR="."+a.RECYCLE_CLASS,a.LISTITEM_BASE_CLASS="listview-item-base",a.LISTITEM_BASE_CLASS_SELECTOR="."+a.LISTITEM_BASE_CLASS,a.DATA_PAGE_INDEX="data-page-index",a.DATA_CONTAINER_INDEX="data-container-index"}(b=a.ListViewGlobalConfig||(a.ListViewGlobalConfig={}))}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var c;!function(c){var d=a.UI.ListViewGlobalConfig,e=a.UI._ListViewUtils,f="[CDP.UI.LineProfile] ",g=function(){function a(a,b,c,d){this._owner=a,this._height=b,this._initializer=c,this._info=d,this._index=null,this._pageIndex=null,this._offset=null,this._$base=null,this._instance=null}return a.prototype.activate=function(){if(null==this._instance){var a;this._$base=this.prepareBaseElement(),a=b.extend({},{$el:this._$base,owner:this._owner,lineProfile:this},this._info),this._instance=new this._initializer(a),this._$base.show()}this.updatePageIndex(this._$base),"visible"!==this._$base.css("visibility")&&this._$base.css("visibility","visible")},a.prototype.hide=function(){null==this._instance&&this.activate(),"hidden"!==this._$base.css("visibility")&&this._$base.css("visibility","hidden")},a.prototype.inactivate=function(){null!=this._instance&&("visible"!==this._$base.css("visibility")&&this._$base.css("visibility","visible"),this._instance.remove(),this._instance=null,this._$base.addClass(d.RECYCLE_CLASS),this._$base.hide(),this._$base=null)},a.prototype.refresh=function(){null!=this._instance&&this._instance.render()},a.prototype.isActive=function(){return null!=this._instance},a.prototype.updateHeight=function(a,b){var c=a-this._height;this._height=a,this._owner.updateScrollMapHeight(c),null!=b&&b.reflectAll&&this._owner.updateProfiles(this._index)},a.prototype.resetDepth=function(){null!=this._instance&&this._$base.css("z-index",this._owner.getListViewOptions().baseDepth)},Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"index",{get:function(){return this._index},set:function(a){this._index=a,null!=this._$base&&this.updateIndex(this._$base)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pageIndex",{get:function(){return this._pageIndex},set:function(a){this._pageIndex=a,null!=this._$base&&this.updatePageIndex(this._$base)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"offset",{get:function(){return this._offset},set:function(a){this._offset=a,null!=this._$base&&this.updateOffset(this._$base)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"info",{get:function(){return this._info},enumerable:!0,configurable:!0}),a.prototype.prepareBaseElement=function(){var a,c=this._owner.getScrollMapElement(),e=this._owner.findRecycleElements().first(),g=this._owner.getListViewOptions().itemTagName;return null!=this._$base?(console.warn(f+"this._$base is not null."),this._$base):(0<e.length?(a=e,a.removeAttr("z-index"),a.removeClass(d.RECYCLE_CLASS)):(a=b("<"+g+" class='"+d.LISTITEM_BASE_CLASS+"'></"+g+">"),a.hide(),c.append(a)),a.height()!==this._height&&a.height(this._height),this.updateIndex(a),this.updateOffset(a),a)},a.prototype.updateIndex=function(a){a.attr(d.DATA_CONTAINER_INDEX)!==this._index.toString()&&a.attr(d.DATA_CONTAINER_INDEX,this._index.toString())},a.prototype.updatePageIndex=function(a){a.attr(d.DATA_PAGE_INDEX)!==this._pageIndex.toString()&&a.attr(d.DATA_PAGE_INDEX,this._pageIndex.toString())},a.prototype.updateOffset=function(a){var b={};if(this._owner.getListViewOptions().enableTransformOffset){if(e.getCssMatrixValue(a,"translateY")!==this._offset){for(var c=0;c<e.cssPrefixes.length;c++)b[e.cssPrefixes[c]+"transform"]="translate3d(0px,"+this._offset+"px,0px)";a.css(b)}}else parseInt(a.css("top"),10)!==this._offset&&a.css("top",this._offset+"px")},a}();c.LineProfile=g}(c=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var c;!function(a){var c="[CDP.UI.GroupProfile] ",d=function(){function d(a,b){this._id=a,this._owner=b,this._parent=null,this._children=[],this._expanded=!1,this._status="unregistered",this._mapLines={}}return d.prototype.addItem=function(c,e,f,g){var h,i=b.extend({},{groupProfile:this},f);return null==g&&(g=d.LAYOUT_KEY_DEFAULT),null==this._mapLines[g]&&(this._mapLines[g]=[]),h=new a.LineProfile(this._owner,Math.floor(c),e,i),"registered"!==this._status||null!=this._owner.layoutKey&&g!==this._owner.layoutKey||(this._owner._addLine(h,this.getLastLineIndex()+1),this._owner.update()),this._mapLines[g].push(h),this},d.prototype.addChildren=function(a){var b=this,c=a instanceof Array?a:[a];return c.forEach(function(a){a.setParent(b)}),this._children=this._children.concat(c),this},d.prototype.getParent=function(){return this._parent},d.prototype.getChildren=function(){return this._children},d.prototype.hasChildren=function(a){return this._children.length<=0?!1:null!=a?this._children[0].hasLayoutKeyOf(a):!0},d.prototype.hasLayoutKeyOf=function(a){return null==a&&(a=d.LAYOUT_KEY_DEFAULT),null!=this._mapLines[a]},d.prototype.expand=function(){var a=this,b=[];this._lines.length<0?console.warn(c+"this group has no lines."):this.hasChildren()?this.isExpanded()||(b=this.queryOperationTarget("registered"),this._expanded=!0,0<b.length&&this._owner.statusScope("expanding",function(){a._lines.forEach(function(a){a.refresh()}),a._owner._addLine(b,a.getLastLineIndex()+1),a._owner.update()})):console.warn(c+"this group has no children.")},d.prototype.collapse=function(a){var b=this,d=[];this.hasChildren()?this.isExpanded()&&(d=this.queryOperationTarget("unregistered"),this._expanded=!1,0<d.length&&(a=null!=a?a:this._owner.getListViewOptions().animationDuration,this._owner.statusScope("collapsing",function(){b._lines.forEach(function(a){a.refresh()}),b._owner.removeItem(d[0].index,d.length,a),b._owner.update()}))):console.warn(c+"this group has no children.")},d.prototype.ensureVisible=function(a){0<this._lines.length?this._owner.ensureVisible(this._lines[0].index,a):null!=a.callback&&a.callback()},d.prototype.toggle=function(a){this._expanded?this.collapse(a):this.expand()},d.prototype.isExpanded=function(){return this._expanded},d.prototype.register=function(a){return this._parent?console.error(c+"logic error: 'register' method is acceptable only top group."):this._owner._addLine(this.preprocess("registered"),a),this},d.prototype.restore=function(){var a=[];return this._parent?console.error(c+"logic error: 'restore' method is acceptable only top group."):this._lines&&(a=this._expanded?this._lines.concat(this.queryOperationTarget("active")):this._lines,this._owner._addLine(a)),this},d.prototype.getLastLineIndex=function(a){var b=this;void 0===a&&(a=!1);var d=function(){var c;return a&&(c=b.queryOperationTarget("active")),(null==c||c.length<=0)&&(c=b._lines),c}();return d.length<=0?(console.error(c+"logic error: this group is stil not registered."),null):d[d.length-1].index},Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),d.prototype.setParent=function(a){this._parent=a},d.prototype.preprocess=function(a){var b=[];return a!==this._status&&null!=this._lines&&(b=this._lines),this._status=a,b},d.prototype.queryOperationTarget=function(a){var b=function(d){var e=[];return d._children.forEach(function(d){switch(a){case"registered":e=e.concat(d.preprocess(a));break;case"unregistered":e=e.concat(d.preprocess(a));break;case"active":null!=d._lines&&(e=e.concat(d._lines));break;default:return void console.warn(c+"unknown operation: "+a)}d.isExpanded()&&(e=e.concat(b(d)))}),e};return b(this)},Object.defineProperty(d.prototype,"_lines",{get:function(){var a=this._owner.layoutKey;return null!=a?this._mapLines[a]:this._mapLines[d.LAYOUT_KEY_DEFAULT]},enumerable:!0,configurable:!0}),d.LAYOUT_KEY_DEFAULT="-layout-default",d}();a.GroupProfile=d}(c=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var d;!function(a){function d(a,b){var d=a,e=b instanceof Array?b:[b];return e.forEach(function(a){var b={};c.extendOwn(b,a.prototype),delete b.constructor,d=d.extend(b)}),d}function e(a,b){var c,e=b instanceof Array?b:[b];c=2<=e.length?d(e[0],e.slice(1)):e[0],a=d(c,a)}function f(a,b){var c=b instanceof Array?b:[b];c.forEach(function(b){Object.getOwnPropertyNames(b.prototype).forEach(function(c){a.prototype[c]=b.prototype[c]})})}a.composeViews=d,a.deriveViews=e,a.mixinViews=f;var g;!function(a){a.cssPrefixes=["-webkit-","-moz-","-ms-","-o-",""],a.getCssMatrixValue=function(c,d){for(var e=0,f=0,g=0,h=0,i=0;i<a.cssPrefixes.length;i++){var j=b(c).css(a.cssPrefixes[i]+"transform");if(j){var k=-1!==j.indexOf("3d")?!0:!1;j=j.replace("matrix3d","").replace("matrix","").replace(/[^\d.,-]/g,"");var l=j.split(",");e=Number(l[k?12:4]),f=Number(l[k?13:5]),g=Number(l[0]),h=Number(l[k?5:3]);break}}switch(d){case"translateX":return isNaN(e)?0:e;case"translateY":return isNaN(f)?0:f;case"scaleX":return isNaN(g)?1:g;case"scaleY":return isNaN(h)?1:h;default:return 0}},a.transitionEnd="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",a.setTransformsTransitions=function(c,d,e,f){for(var g=b(c),h={},i=e/1e3+"s",j=" "+i+" "+f,k=", transform"+j,l=0;l<a.cssPrefixes.length;l++)h[a.cssPrefixes[l]+"transition"]=d+j+k;g.css(h)},a.clearTransitions=function(c){var d=b(c);d.off(a.transitionEnd);for(var e={},f=0;f<a.cssPrefixes.length;f++)e[a.cssPrefixes[f]+"transition"]="";d.css(e)},a.abs=function(a){return a>=0?a:-a},a.max=function(a,b){return a>=b?a:b}}(g=a._ListViewUtils||(a._ListViewUtils={}))}(d=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b=function(){function a(){this._status={}}return a.prototype.statusAddRef=function(a){return this._status[a]?this._status[a]++:this._status[a]=1,this._status[a]},a.prototype.statusRelease=function(a){var b;return this._status[a]?(this._status[a]--,b=this._status[a],0===b&&delete this._status[a]):b=0,b},a.prototype.statusScope=function(a,b){this.statusAddRef(a),b(),this.statusRelease(a)},a.prototype.isStatusIn=function(a){return!!this._status[a]},a}();a.StatusManager=b}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b=function(){function a(){this._index=0,this._offset=0,this._height=0,this._lines=[],this._status="inactive"}return a.prototype.activate=function(){"active"!==this._status&&this._lines.forEach(function(a){a.activate()}),this._status="active"},a.prototype.hide=function(){"hidden"!==this._status&&this._lines.forEach(function(a){a.hide()}),this._status="hidden"},a.prototype.inactivate=function(){"inactive"!==this._status&&this._lines.forEach(function(a){a.inactivate()}),this._status="inactive"},a.prototype.push=function(a){this._lines.push(a),this._height+=a.height},a.prototype.normalize=function(){var a=c.every(this._lines,function(a){return a.isActive()});a||(this._status="inactive")},a.prototype.getLineProfile=function(a){return a>=0&&a<this._lines.length?this._lines[a]:null},a.prototype.getLineProfileFirst=function(){return this.getLineProfile(0)},a.prototype.getLineProfileLast=function(){return this.getLineProfile(this._lines.length-1)},Object.defineProperty(a.prototype,"index",{get:function(){return this._index},set:function(a){this._index=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"offset",{get:function(){return this._offset},set:function(a){this._offset=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),a}();a.PageProfile=b}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var c;!function(c){var d=a.UI._ListViewUtils,e="[CDP.UI.ScrollerElement] ",f=function(){function a(a,c){this._$target=null,this._$scrollMap=null,this._listviewOptions=null,this._$target=b(a),this._listviewOptions=c}return a.prototype.getType=function(){return"element-overflow"},a.prototype.getPos=function(){return this._$target.scrollTop()},a.prototype.getPosMax=function(){return null==this._$scrollMap&&(this._$scrollMap=this._$target.children().first()),d.max(this._$scrollMap.height()-this._$target.height(),0)},a.prototype.on=function(a,b){switch(a){case"scroll":this._$target.on("scroll",b);break;case"scrollstop":this._$target.on("scrollstop",b);break;default:console.warn(e+"unsupported type: "+a)}},a.prototype.off=function(a,b){switch(a){case"scroll":this._$target.off("scroll",b);break;case"scrollstop":this._$target.off("scrollstop",b);break;default:console.warn(e+"unsupported type: "+a)}},a.prototype.scrollTo=function(a,b,c){this._listviewOptions.enableAnimation&&b?(null==c&&(c=this._listviewOptions.animationDuration),this._$target.animate({scrollTop:a},c)):this._$target.scrollTop(a)},a.prototype.update=function(){},a.prototype.destroy=function(){this._$scrollMap=null,this._$target=null},a.getFactory=function(){var b=function(b,c){return new a(b,c)};return b},a}();c.ScrollerElement=f}(c=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var c;!function(c){var d=a.UI._ListViewUtils,e="[CDP.UI.ScrollerNative] ",f=function(){function a(a){this._$body=null,this._$target=null,this._$scrollMap=null,this._listviewOptions=null,this._$target=b(document),this._$body=b("body"),this._listviewOptions=a}return a.prototype.getType=function(){return"native-scroll"},a.prototype.getPos=function(){return this._$target.scrollTop()},a.prototype.getPosMax=function(){return d.max(this._$target.height()-window.innerHeight,0)},a.prototype.on=function(a,c){switch(a){case"scroll":this._$target.on("scroll",c);break;case"scrollstop":b(window).on("scrollstop",c);break;default:console.warn(e+"unsupported type: "+a)}},a.prototype.off=function(a,c){switch(a){case"scroll":this._$target.off("scroll",c);break;case"scrollstop":b(window).off("scrollstop",c);break;default:console.warn(e+"unsupported type: "+a)}},a.prototype.scrollTo=function(a,b,c){this._listviewOptions.enableAnimation&&b?(null==c&&(c=this._listviewOptions.animationDuration),this._$body.animate({scrollTop:a},c)):this._$body.scrollTop(a)},a.prototype.update=function(){},a.prototype.destroy=function(){this._$scrollMap=null,this._$target=null},a.getFactory=function(){var b=function(b,c){return new a(c)};return b},a}();c.ScrollerNative=f}(c=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var d;!function(d){var e=a.UI.ListViewGlobalConfig,f=a.UI._ListViewUtils,g="[CDP.UI.ScrollerIScroll] ",h=function(){function a(a,c,d,e){this._$owner=null,this._iscroll=null,this._refreshTimerId=null,this._$wrapper=null,this._$scroller=null,this._listviewOptions=null,null!=IScroll?(this._$owner=a,this._iscroll=new IScroll(c,d),this._$wrapper=b(this._iscroll.wrapper),this._$scroller=b(this._iscroll.scroller),this._listviewOptions=e):console.error(g+"iscroll module doesn't load.")}return a.prototype.getType=function(){return"iscroll"},a.prototype.getPos=function(){var a=this._iscroll.getComputedPosition().y;return a=c.isNaN(a)?0:-a},a.prototype.getPosMax=function(){return f.max(-this._iscroll.maxScrollY,0)},a.prototype.on=function(a,b){switch(a){case"scroll":this._iscroll.on("scroll",b);break;case"scrollstop":this._iscroll.on("scrollEnd",b);break;default:console.warn(g+"unsupported type: "+a)}},a.prototype.off=function(a,b){switch(a){case"scroll":this._iscroll.off("scroll",b);break;case"scrollstop":this._iscroll.on("scrollEnd",b);break;default:console.warn(g+"unsupported type: "+a)}},a.prototype.scrollTo=function(a,b,c){var c=0;this._listviewOptions.enableAnimation&&b&&(c=c||this._listviewOptions.animationDuration),this._iscroll.scrollTo(0,-a,c)},a.prototype.update=function(){var a=this;if(this._$owner){!function(){var b=a._$owner.height();b!==a._$wrapper.height()&&a._$wrapper.height(b)}(),null!=this._refreshTimerId&&clearTimeout(this._refreshTimerId);var b=function(){a._$scroller&&a._$scroller.height()!==a._iscroll.scrollerHeight?(a._iscroll.refresh(),a._refreshTimerId=setTimeout(b,a._listviewOptions.scrollMapRefreshInterval)):a._refreshTimerId=null};this._iscroll.refresh(),this._refreshTimerId=setTimeout(b,this._listviewOptions.scrollMapRefreshInterval)}},a.prototype.destroy=function(){this._$scroller=null,this._$wrapper=null,this._iscroll.destroy(),this._$owner=null},a.getFactory=function(c){var d={scrollX:!1,bounce:!1,mouseWheel:!0,scrollbars:!0,interactiveScrollbars:!0,shrinkScrollbars:"scale",fadeScrollbars:!0,probeType:2},f=b.extend({},d,c),g=function(c,d){var g=b(c),h=g.find(e.SCROLL_MAP_SELECTOR),i=b("<div class='"+e.WRAPPER_CLASS+"'></div>").css({position:"absolute",width:"100%",height:"100%",overflow:"hidden"});return h.wrap(i),new a(g,e.WRAPPER_SELECTOR,f,d)};return g},a}();d.ScrollerIScroll=h}(d=a.UI||(a.UI={}))}(a||(a={}));var a,e=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c};!function(a){var b;!function(a){var b="[CDP.UI.ListItemView] ",c=function(c){function d(a){if(c.call(this,a),this._owner=null,this._lineProfile=null,this._owner=a.owner,a.$el){var b=this.events?!0:!1;this.setElement(a.$el,b)}this._lineProfile=a.lineProfile}return e(d,c),d.prototype.render=function(){return console.warn(b+"need override 'render()' method."),this},d.prototype.getIndex=function(){return this._lineProfile.index},d.prototype.getSpecifiedHeight=function(){return this._lineProfile.height},d.prototype.hasChildNode=function(){return this.$el?0<this.$el.children().length:!1},d.prototype.updateHeight=function(a,b){return this.$el&&this.getSpecifiedHeight()!==a&&(this._lineProfile.updateHeight(a,b),this.$el.height(a)),this},d.compose=function(b,c,e){var f=a.composeViews(d,b);return f.extend(c,e)},d.prototype.remove=function(){return this.$el.find("figure").css("background-image","none"),this.$el.children().remove(),this.$el.off(),this.$el=null,this.stopListening(),this._lineProfile=null,this},Object.defineProperty(d.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),d}(d.View);a.ListItemView=c}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var d;!function(d){var e=a.UI.ListViewGlobalConfig,f=a.UI._ListViewUtils,g="[CDP.UI.ScrollManager] ",h=function(){function a(a){var c=this;this._$root=null,this._$map=null,this._mapHeight=0,this._scroller=null,this._settings=null,this._active=!0,this._scrollEventHandler=null,this._scrollStopEventHandler=null,this._baseHeight=0,this._lines=[],this._pages=[],this._lastActivePageContext={index:0,from:0,to:0,pos:0},this._backup={};var e={scrollerFactory:d.ScrollerNative.getFactory(),enableHiddenPage:!1,enableTransformOffset:!1,scrollMapRefreshInterval:200,scrollRefreshDistance:200,pagePrepareCount:3,pagePreloadCount:1,enableAnimation:!0,animationDuration:0,baseDepth:"auto",itemTagName:"div",removeItemWithTransition:!0,useDummyInactiveScrollMap:!1};this._settings=b.extend({},e,a),this._scrollEventHandler=function(a){c.onScroll(c._scroller.getPos())},this._scrollStopEventHandler=function(a){c.onScrollStop(c._scroller.getPos())}}return a.prototype.initialize=function(a,b){this._$root=a,this._$map=a.hasClass(e.SCROLL_MAP_CLASS)?a:a.find(e.SCROLL_MAP_SELECTOR),this._scroller=this.createScroller(),this.setBaseHeight(b),this.setScrollerCondition()},a.prototype.destroy=function(){this._scroller&&(this.resetScrollerCondition(),this._scroller.destroy(),this._scroller=null),this.release(),this._$map=null,this._$root=null},a.prototype.setBaseHeight=function(a){this._baseHeight=a,this._baseHeight<=0&&console.warn(g+"invalid base height: "+this._baseHeight),this._scroller&&this._scroller.update()},a.prototype.setActiveState=function(a){this._active=a,this.treatScrollPosition()},a.prototype.isActive=function(){return this._active},a.prototype.treatScrollPosition=function(){var a,b=this,c={},d=function(d,e){if(e=e||b._scroller.getPos()-b._lastActivePageContext.pos,f.getCssMatrixValue(d,"translateY")!==e){for(a=0;a<f.cssPrefixes.length;a++)c[f.cssPrefixes[a]+"transform"]="translate3d(0px,"+e+"px,0px)";return d.css(c),d}},e=function(b){for(a=0;a<f.cssPrefixes.length;a++)c[f.cssPrefixes[a]+"transform"]="";return b.css(c),b};this._active?(!function(){b._scroller&&b._scroller.scrollTo(b._lastActivePageContext.pos,!1,0),e(b._$map).show()}(),this._settings.useDummyInactiveScrollMap&&this.prepareInactiveMap().remove()):d(this._settings.useDummyInactiveScrollMap?this.prepareInactiveMap():this._$map)},a.prototype.prepareInactiveMap=function(){var a=this._$map.parent(),c=a.find(e.INACTIVE_CLASS_SELECTOR);if(c.length<=0){var d=this.getPageIndex(),f=this._$map.clone().children().filter(function(a,c){var f=~~b(c).attr(e.DATA_PAGE_INDEX);return f>=d-1||d+1>=f?!0:!1});c=b("<section class='"+e.SCROLL_MAP_CLASS+" "+e.INACTIVE_CLASS+"'></section>").append(f).height(this._mapHeight),a.append(c),this._$map.hide()}return c},a.prototype.isInitialized=function(){return!!this._$root},a.prototype.addItem=function(a,b,c,e){this._addLine(new d.LineProfile(this,Math.floor(a),b,c),e)},a.prototype._addLine=function(a,b){var c,d,e=0,f=a instanceof Array?a:[a],g=!1;for(null==b&&(b=this._lines.length),b===this._lines.length&&(g=!0),c=0,d=f.length;d>c;c++)e+=f[c].height;for(this.updateScrollMapHeight(e),c=f.length-1;c>=0;c--)this._lines.splice(b,0,f[c]);g||(0===b?this.clearPage():null!=this._lines[b-1].pageIndex&&this.clearPage(this._lines[b-1].pageIndex)),this.updateProfiles(b)},a.prototype.removeItem=function(a,b,c){var d=this;if(null==b&&(b=1),0>a||this._lines.length<a+b)return void console.error(g+"logic error. GroupProfile.removeItem(), invalid index: "+a);c=null!=c?c:0;var e=function(a,b){var c=function(b){a.off(f.transitionEnd),f.clearTransitions(a)};d._$map.on(f.transitionEnd,c),f.setTransformsTransitions(a,"height",b,"ease")},h=0,i=[],j=!1;!function(){for(var e,f=0;b>f;f++)e=d._lines[a+f],h+=e.height,e.resetDepth(),i.push(e);if(d._settings.removeItemWithTransition&&c>0){var g=d.getScrollPos(),k=d.getScrollPosMax()-h;j=g>k}}(),function(){j&&e(d._$map,c),null!=d._lines[a].pageIndex&&d.clearPage(d._lines[a].pageIndex),d.updateScrollMapHeight(-h),d._lines.splice(a,b),d.updateProfiles(a),setTimeout(function(){i.forEach(function(a){a.inactivate()})},c)}()},a.prototype.getItemInfo=function(a){var c,d=function(a){return a.hasClass(e.LISTITEM_BASE_CLASS)?~~a.attr(e.DATA_CONTAINER_INDEX):a.hasClass(e.SCROLL_MAP_CLASS)||a.length<=0?(console.warn(g+"cannot ditect line from event object."),null):d(a.parent())};return a instanceof b.Event?c=d(b(a.currentTarget)):"number"==typeof a&&(c=a),null==c?(console.error(g+"logic error. unsupported arg type. type: "+typeof a),null):0>c||this._lines.length<=c?(console.error(g+"logic error. invalid range. index: "+c),null):this._lines[c].info},a.prototype.refresh=function(){var a=this,b={},d=this._settings.pagePrepareCount+this._settings.pagePreloadCount,e=this.getPageIndex(),h=[],i=c.filter(this._pages,function(a){return"inactive"!==a.status}),j=function(c){c===e?(b[c]="activate",h.push(c)):f.abs(e-c)<=a._settings.pagePrepareCount?b[c]="activate":a._settings.enableHiddenPage?b[c]="hide":b[c]="activate",(e+1===c||e-1===c)&&h.push(c)};this._lines.length<=0||(!function(){var b=0,c=0,f=0,g=0,h=e-d,i=e+d;for(c=h;i>=c;c++)0>c?f++:a._pages.length<=c?g++:j(c);if(f>0)for(b=0,c=e+d+1;f>b&&!(a._pages.length<=c);b++,c++)j(c);if(g>0)for(b=0,c=e-d-1;g>b&&!(0>c);b++,c--)j(c)}(),i.forEach(function(a){var c=a.index;null==b[c]&&a.inactivate()}),h.sort(function(a,b){return b>a?-1:a>b?1:0}).forEach(function(b){setTimeout(function(){a.isInitialized()&&a._pages[b]&&a._pages[b].activate()},0)}),c.each(b,function(c,d){setTimeout(function(){if(a.isInitialized()){var e=~~d;switch(c){case"activate":a._pages[e]&&a._pages[e].activate();break;case"hide":a._pages[e]&&a._pages[e].hide();break;case"inactivate":console.warn(g+"unexpected operation: inactivate");break;default:console.warn(g+"unknown operation: "+b[d])}}},0)}),this.findRecycleElements().remove(),this._lastActivePageContext.from=this._pages[e].getLineProfileFirst().index,this._lastActivePageContext.to=this._pages[e].getLineProfileLast().index,this._lastActivePageContext.index=e)},a.prototype.update=function(){var a=this._pages.length;this.assignPage(a),this.refresh()},a.prototype.rebuild=function(){this.clearPage(),this.assignPage(),this.refresh()},a.prototype.release=function(){this._lines.forEach(function(a){a.inactivate()}),this._pages=[],this._lines=[],this._$map&&(this._mapHeight=0,this._$map.height(0))},a.prototype.backup=function(a){return null==this._backup[a]&&(this._backup[a]={lines:this._lines}),!0},a.prototype.restore=function(a,b){return void 0===b&&(b=!0),null==this._backup[a]?!1:(0<this._lines.length&&this.release(),this._addLine(this._backup[a].lines),b&&this.rebuild(),!0)},a.prototype.hasBackup=function(a){return null!=this._backup[a]?!0:!1},a.prototype.clearBackup=function(a){return null==a?(this._backup={},!0):null!=this._backup[a]?(delete this._backup[a],!0):!1},Object.defineProperty(a.prototype,"backupData",{get:function(){return this._backup},enumerable:!0,configurable:!0}),a.prototype.setScrollHandler=function(a,b){this._scroller&&(b?this._scroller.on("scroll",a):this._scroller.off("scroll",a))},a.prototype.setScrollStopHandler=function(a,b){this._scroller&&(b?this._scroller.on("scrollstop",a):this._scroller.off("scrollstop",a))},a.prototype.getScrollPos=function(){return this._scroller?this._scroller.getPos():0},a.prototype.getScrollPosMax=function(){return this._scroller?this._scroller.getPosMax():0},a.prototype.scrollTo=function(a,b,c){this._scroller&&(0>a?(console.warn(g+"invalid position, too small. [pos: "+a+"]"),a=0):this._scroller.getPosMax()<a&&(console.warn(g+"invalid position, too big. [pos: "+a+"]"),a=this._scroller.getPosMax()),this._lastActivePageContext.pos=a,a!==this._scroller.getPos()&&this._scroller.scrollTo(a,b,c))},a.prototype.ensureVisible=function(a,c){var d=this;return 0>a||this._lines.length<=a?void console.warn(g+"ensureVisible(), invalid index, noop. [index: "+a+"]"):this._scroller?void function(){var e,f=d._lines[a],h={partialOK:!0,setTop:!1,animate:d._settings.enableAnimation,time:d._settings.animationDuration,callback:function(){}},i=b.extend({},h,c),j={from:d._scroller.getPos(),to:d._scroller.getPos()+d._baseHeight},k={from:f.offset,to:f.offset+f.height},l=function(){return i.partialOK?k.from<=j.from?j.from<=k.to?!0:!1:k.from<=j.to?!0:!1:j.from<=k.from&&k.to<=j.to?!0:!1},m=function(){return k.from<j.from?k.from:j.from<k.from?f.offset-f.height:(console.warn(g+"logic error."),0)};if(i.setTop)e=k.from;else{if(l())return void i.callback();e=m()}0>e?e=0:d._scroller.getPosMax()<e&&(e=d._scroller.getPosMax()),setTimeout(i.callback,i.time),d.scrollTo(e,i.animate,i.time)}():void console.warn(g+"scroller is not ready.")},a.prototype.getScrollMapHeight=function(){return this._$map?this._mapHeight:0},a.prototype.updateScrollMapHeight=function(a){this._$map&&(this._mapHeight+=a,this._mapHeight<0&&(this._mapHeight=0),this._$map.height(this._mapHeight))},a.prototype.updateProfiles=function(a){var b,c,d;for(b=a,c=this._lines.length;c>b;b++)b>0?(d=this._lines[b-1],this._lines[b].index=d.index+1,this._lines[b].offset=d.offset+d.height):(this._lines[b].index=0,this._lines[b].offset=0)},a.prototype.getScrollMapElement=function(){return this._$map||b("")},a.prototype.findRecycleElements=function(){return this._$map?this._$map.find(e.RECYCLE_CLASS_SELECTOR):b("")},a.prototype.getListViewOptions=function(){return this._settings},a.prototype.setScrollerCondition=function(){this._scroller.on("scroll",this._scrollEventHandler),this._scroller.on("scrollstop",this._scrollStopEventHandler)},a.prototype.resetScrollerCondition=function(){this._scroller.off("scrollstop",this._scrollStopEventHandler),this._scroller.off("scroll",this._scrollEventHandler)},a.prototype.createScroller=function(){return this._settings.scrollerFactory(this._$root[0],this._settings)},a.prototype.getPageIndex=function(){var a,b,c,d,e=this,f=this._scroller?this._scroller.getPos():0,h=this._scroller?this._scroller.getPosMax():0,i=function(){var a=e.getLastPage();return null!=a?a.offset+a.height:e._baseHeight}(),j=function(){return 0===h||h<=e._baseHeight?0:f*i/h}(),k=function(a){return null==a?!1:a.offset<=j&&j<=a.offset+a.height?!0:!1};if(this._baseHeight<=0)return console.error(g+"invalid base height: "+this._baseHeight),0;if(d=Math.floor(j/this._baseHeight),this._pages.length<=d&&(d=this._pages.length-1),c=this._pages[d],k(c))return c.index;if(j<c.offset){for(a=d-1;a>=0;a--)if(c=this._pages[a],k(c))return c.index;return console.warn(g+"unknown page index."),0}for(a=d+1,b=this._pages.length;b>a;a++)if(c=this._pages[a],k(c))return c.index;return console.warn(g+"unknown page index."),this.getLastPage().index},a.prototype.onScroll=function(a){if(this._active&&0<this._pages.length){var b=this.getPageIndex();f.abs(a-this._lastActivePageContext.pos)<this._settings.scrollRefreshDistance&&this._lastActivePageContext.index!==b&&this.refresh(),this._lastActivePageContext.pos=a}},a.prototype.onScrollStop=function(a){if(this._active&&0<this._pages.length){var b=this.getPageIndex();this._lastActivePageContext.index!==b&&this.refresh(),this._lastActivePageContext.pos=a}},a.prototype.getLastPage=function(){return 0<this._pages.length?this._pages[this._pages.length-1]:null},a.prototype.assignPage=function(a){var b,c,e=this;null==a?a=0:this.clearPage(a),function(){var a,f,g=0,h=e.getLastPage();null==h?(h=new d.PageProfile,e._pages.push(h)):(a=h.getLineProfileLast(),null!=a&&(g=a.index+1));var i=e._lines.slice(g);for(b=0,c=i.length;c>b;b++)e._baseHeight<=h.height&&(h.normalize(),f=h,f=new d.PageProfile,f.index=h.index+1,f.offset=h.offset+h.height,h=f,e._pages.push(h)),i[b].pageIndex=h.index,h.push(i[b]);h.normalize()}(),this._scroller&&this._scroller.update()},a.prototype.clearPage=function(a){null==a&&(a=0),this._pages=this._pages.slice(0,a)},a}();d.ScrollManager=h}(d=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var c;!function(a){var c=function(c){function d(b){if(c.call(this,b),this._scrollMgr=null,this._scrollMgr=new a.ScrollManager(b),b.$el){var d=this.events?!0:!1;this.setElement(b.$el,d)}}return e(d,c),d.prototype.setElement=function(a,d){if(this._scrollMgr){var e=b(a);this._scrollMgr.destroy(),this._scrollMgr.initialize(e,e.height())}return c.prototype.setElement.call(this,a,d)},d.prototype.remove=function(){return this._scrollMgr.destroy(),c.prototype.remove.call(this)},d.prototype.isInitialized=function(){return this._scrollMgr.isInitialized()},d.prototype.addItem=function(b,c,d,e){this._addLine(new a.LineProfile(this,Math.floor(b),c,d),e)},d.prototype._addLine=function(a,b){this._scrollMgr._addLine(a,b)},d.prototype.removeItem=function(a,b,c){this._scrollMgr.removeItem(a,b,c)},d.prototype.getItemInfo=function(a){return this._scrollMgr.getItemInfo(a)},d.prototype.refresh=function(){this._scrollMgr.refresh()},d.prototype.update=function(){this._scrollMgr.update()},d.prototype.rebuild=function(){this._scrollMgr.rebuild()},d.prototype.release=function(){this._scrollMgr.release()},d.prototype.backup=function(a){return this._scrollMgr.backup(a)},d.prototype.restore=function(a,b){return void 0===b&&(b=!0),this._scrollMgr.restore(a,b)},d.prototype.hasBackup=function(a){return this._scrollMgr.hasBackup(a)},d.prototype.clearBackup=function(a){
return this._scrollMgr.clearBackup(a)},Object.defineProperty(d.prototype,"backupData",{get:function(){return this._scrollMgr?this._scrollMgr.backupData:null},enumerable:!0,configurable:!0}),d.prototype.setScrollHandler=function(a,b){this._scrollMgr.setScrollHandler(a,b)},d.prototype.setScrollStopHandler=function(a,b){this._scrollMgr.setScrollStopHandler(a,b)},d.prototype.getScrollPos=function(){return this._scrollMgr.getScrollPos()},d.prototype.getScrollPosMax=function(){return this._scrollMgr.getScrollPosMax()},d.prototype.scrollTo=function(a,b,c){this._scrollMgr.scrollTo(a,b,c)},d.prototype.ensureVisible=function(a,b){this._scrollMgr.ensureVisible(a,b)},d.prototype.getScrollMapHeight=function(){return this._scrollMgr.getScrollMapHeight()},d.prototype.updateScrollMapHeight=function(a){this._scrollMgr.updateScrollMapHeight(a)},d.prototype.updateProfiles=function(a){this._scrollMgr.updateProfiles(a)},d.prototype.getScrollMapElement=function(){return this._scrollMgr.getScrollMapElement()},d.prototype.findRecycleElements=function(){return this._scrollMgr.findRecycleElements()},d.prototype.getListViewOptions=function(){return this._scrollMgr.getListViewOptions()},d.compose=function(b,c,e){var f=a.composeViews(d,b);return f.extend(c,e)},d}(d.View);a.ListView=c}(c=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b=function(a){function b(b){a.call(this,b),this._groupProfile=null,this._groupProfile=b.groupProfile}return e(b,a),b.prototype.isExpanded=function(){return this._groupProfile.isExpanded()},b.prototype.isExpanding=function(){return this.owner.isExpanding()},b.prototype.isCollapsing=function(){return this.owner.isCollapsing()},b.prototype.isSwitching=function(){return this.owner.isSwitching()},b.prototype.hasChildren=function(a){return this._groupProfile.hasChildren(a)},b}(a.ListItemView);a.GroupListItemView=b}(b=a.UI||(a.UI={}))}(a||(a={}));var a;!function(a){var b;!function(a){var b="[CDP.UI.ExpandManager] ",d=function(){function d(a){this._owner=null,this._mapGroups={},this._aryTopGroups=[],this._layoutKey=null,this._owner=a}return d.prototype.newGroup=function(b){var c;return null==b&&(b="group-id:"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)),null!=this._mapGroups[b]?this._mapGroups[b]:(c=new a.GroupProfile(b,this._owner),this._mapGroups[b]=c,c)},d.prototype.getGroup=function(a){return null==this._mapGroups[a]?(console.warn(b+"group id: "+a+" is not registered."),null):this._mapGroups[a]},d.prototype.registerTopGroup=function(a){var d,e;return"registered"===a.status?void a.restore():(d=0<this._aryTopGroups.length?this._aryTopGroups[this._aryTopGroups.length-1]:null,e=null!=d?d.getLastLineIndex(!0)+1:0,c.isNaN(e)?void console.error(b+"logic error, 'insertTo' is NaN."):(this._aryTopGroups.push(a),void a.register(e)))},d.prototype.getTopGroups=function(){return this._aryTopGroups.slice(0)},d.prototype.expandAll=function(){this._aryTopGroups.forEach(function(a){a.hasChildren()&&a.expand()})},d.prototype.collapseAll=function(a){this._aryTopGroups.forEach(function(b){b.hasChildren()&&b.collapse(a)})},d.prototype.isExpanding=function(){return this._owner.isStatusIn("expanding")},d.prototype.isCollapsing=function(){return this._owner.isStatusIn("collapsing")},d.prototype.isSwitching=function(){return this.isExpanding()||this.isCollapsing()},d.prototype.statusAddRef=function(a){return this._owner.statusAddRef(a)},d.prototype.statusRelease=function(a){return this._owner.statusRelease(a)},d.prototype.statusScope=function(a,b){this._owner.statusScope(a,b)},d.prototype.isStatusIn=function(a){return this._owner.isStatusIn(a)},Object.defineProperty(d.prototype,"layoutKey",{get:function(){return this._layoutKey},set:function(a){this._layoutKey=a},enumerable:!0,configurable:!0}),d.prototype.release=function(){this._mapGroups={},this._aryTopGroups=[]},d.prototype.backup=function(a){var b=this.backupData;return null==b[a]&&(b[a]={map:this._mapGroups,tops:this._aryTopGroups}),!0},d.prototype.restore=function(a,b){void 0===b&&(b=!0);var c=this.backupData;return null==c[a]?!1:(0<this._aryTopGroups.length&&this.release(),this._mapGroups=c[a].map,this._aryTopGroups=c[a].tops,this._aryTopGroups.length<=0||!this._aryTopGroups[0].hasLayoutKeyOf(this.layoutKey)?!1:(this._aryTopGroups.forEach(function(a){a.restore()}),b&&this._owner.rebuild(),!0))},d.prototype.hasBackup=function(a){return this._owner.hasBackup(a)},d.prototype.clearBackup=function(a){return this._owner.clearBackup(a)},Object.defineProperty(d.prototype,"backupData",{get:function(){return this._owner.backupData},enumerable:!0,configurable:!0}),d}();a.ExpandManager=d}(b=a.UI||(a.UI={}))}(a||(a={}));var a;return function(a){var b;!function(a){var b=function(b){function c(c){b.call(this,c),this._statusMgr=null,this._expandManager=null,this._statusMgr=new a.StatusManager,this._expandManager=new a.ExpandManager(this)}return e(c,b),c.prototype.newGroup=function(a){return this._expandManager.newGroup(a)},c.prototype.getGroup=function(a){return this._expandManager.getGroup(a)},c.prototype.registerTopGroup=function(a){this._expandManager.registerTopGroup(a)},c.prototype.getTopGroups=function(){return this._expandManager.getTopGroups()},c.prototype.expandAll=function(){this._expandManager.expandAll()},c.prototype.collapseAll=function(a){this._expandManager.collapseAll(a)},c.prototype.isExpanding=function(){return this._expandManager.isExpanding()},c.prototype.isCollapsing=function(){return this._expandManager.isCollapsing()},c.prototype.isSwitching=function(){return this._expandManager.isSwitching()},c.prototype.statusAddRef=function(a){return this._statusMgr.statusAddRef(a)},c.prototype.statusRelease=function(a){return this._statusMgr.statusRelease(a)},c.prototype.statusScope=function(a,b){this._statusMgr.statusScope(a,b)},c.prototype.isStatusIn=function(a){return this._statusMgr.isStatusIn(a)},Object.defineProperty(c.prototype,"layoutKey",{get:function(){return this._expandManager.layoutKey},set:function(a){this._expandManager.layoutKey=a},enumerable:!0,configurable:!0}),c.prototype.release=function(){b.prototype.release.call(this),this._expandManager.release()},c.prototype.backup=function(a){return this._expandManager.backup(a)},c.prototype.restore=function(a,b){return void 0===b&&(b=!0),this._expandManager.restore(a,b)},c}(a.ListView);a.ExpandableListView=b}(b=a.UI||(a.UI={}))}(a||(a={})),a.UI});